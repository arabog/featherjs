<!DOCTYPE html>
<html lang="en">
<head>
          <meta charset="UTF-8">
          <meta http-equiv="X-UA-Compatible" content="IE=edge">
          <meta name="viewport" content="width=device-width, initial-scale=1.0">
          <title>Feather JS</title>
          <link rel="stylesheet" href="//unpkg.com/feathers-chat@4.0.0/public/base.css">
          <link rel="stylesheet" href="//unpkg.com/feathers-chat@4.0.0/public/chat.css">
</head>
<body>
          <main id="main" class="container">
                    <h1>Welcome to Feather</h1>

                    <form 
                              class="form"
                              onsubmit="sendMessage(event.preventDefault())"          
                    >
                              <input 
                                        type="text"
                                        id="message-text"
                                        placeholder="Enter message here"
                              >

                              <button type="submit" class="button button-primary">
                                        Send Message
                              </button>
                    </form>

                    <h2>Here are the current messages:</h2>

          </main>

          <script src="//unpkg.com/@feathersjs/client@^4.3.0/dist/feathers.js"></script>
          <script src="//cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.4/socket.io.js"></script>
          <script type="text/javascript">
                    // setup socket.io
                    const socket = io("http://localhost:3030")

                    // initialize a feathers app
                    const app = feathers()

                    // register socket.io to talk to our server
                    app.configure(feathers.socketio(socket))

                    // form submission handler dt sends a new msg
                    async function sendMessage() {
                              const messageInput = document.getElementById("message-text")

                              // create a new msg with d input field value
                              await app.service("messages").create({
                                        text: messageInput.value
                              })

                              messageInput.value = ""
                    }

                    // render a single msg on d pg
                    function addMessage(message) {
                              document.getElementById("main").innerHTML += `<p> ${message.text} </p>`
                    }

                    const main = async () => {
                              // find all existing msgs
                              const messages = await app.service('messages').find()

                              // add existing msgs to d list
                              messages.forEach(addMessage)

                              // add any newly cr8 msg to d list in real-time
                              app.service("messages").on("created", addMessage)
                    }

                    main()
          </script>
</body>
</html>